<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <link rel="stylesheet" type="text/css" href="/css/jquery.timepicker.css" />
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-datepicker.css" />
    <link rel="stylesheet" type="application/octet-stream" href="/css/bootstrap-datepicker.css.map" />

    <script type="text/javascript" src="/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="/js/jquery.timepicker.js"></script>

    <script type="text/javascript" src="/js/datepair.js"></script>
    <script type="text/javascript" src="/js/jquery.datepair.js"></script>

    <script src='/fullcalendar-6.1.5/dist/index.global.js'></script>
    <script>
        $(function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                headerToolbar: {
                    right: 'addEventButton prev,next today'
                }
                ,editable: true
                ,selectable: true
                ,events: calendarDetailList()
                // ,events:
                //     [
                //         {
                //             "title": "일정",
                //             "start": "2023-04-05T09:00:00",
                //             "end": "2023-04-05T18:00:00"
                //         },
                //         {
                //             "title": "에버랜드",
                //             "start": "2023-04-17T00:00",
                //             "end": "2023-04-18T00:00",
                //             "color" : "pink",
                //             "allDay" : true
                //         },
                //         {
                //             "title": "롯데월드",
                //             "start": "2023-04-14",
                //             "end": "2023-04-14",
                //             "color" : "pink",
                //             "allDay" : true
                //         },
                //         {
                //             "title": "여직원 점심",
                //             "start": "2023-04-19T00:00",
                //             "end": "2023-04-19T00:00"
                //         },
                //         {
                //             "title": "가족모임",
                //             "start": "2023-04-27T09:00:00",
                //             "end": "2023-04-29T18:00:00",
                //             "color" : "green",
                //             "allDay" : true
                //         },
                //         {
                //             "title": "출장",
                //             "start": "2023-04-20T00:00",
                //             "end": "2023-04-21T00:00",
                //             "color" : "black",
                //             "allDay" : true
                //         }
                //     ]
                ,customButtons:{
                    addEventButton : {
                        text: "달력추가",
                        click : function(){
                            setCal();
                            $("#calendarCateModal").modal('show');
                        }
                    }
                }
                ,dateClick : function (info) {
                    setCalDtl('I', info);
                    // $("#calendarDetailModal").modal('show');
                }
                ,eventClick : function (info) {
                    setCalDtl('U', info);
                    // showCalendarDetailView(info);
                }
                ,dayMaxEventRows : 4
                ,editable: false
                ,droppable: false
                ,dayPopoverFormat: { year: 'numeric', month: 'long', day: 'numeric' }
                ,contentHeight : 600
            });

            calendar.render();


            var calendarForm = document.calendarForm;

            $("#updateCalBtn").click(function(){
                calendarForm.submit();
            });

            // 기념일 여부
            $("#memorial_ch").change(function(){
                if($("#memorial_ch").is(":checked")){
                    $("#memorial_yn").val("Y");
                }else{
                    $("#memorial_yn").val("N");
                }
            });
        });

        // 달력 셀에 일정 뿌리기
        function calendarDetailList(){
            let result = "";
            $.ajax({
                url : "/calendars/detail"
                ,method : "GET"
                ,async : false
                ,dataType : "JSON"
                ,success : function (data){
                    result = data;
                }
            });
            return result;
        }

        // 달력 셋팅
        function setCal(){
            $.ajax({
                url : "/calendars/new"
                ,method: "GET"
                ,async: false
                // ,data : data
                ,success : function (data){
                    $("#calendarCateModal").html(data);
                    $("#calendarCateModal").modal('show');
                }
            });
        }

        // 달력 일정 상세 조회
        function setCalDtl(type, info){
            let calId = type == 'I' ? "" : info.event.id;
            let dateStr = type == 'I' ? info.dateStr : "";
            let data = {"calDtlId" : calId, "dateStr" : dateStr};
            $.ajax({
                url : "/calendars/detail/new"
                ,method: "GET"
                ,async: false
                ,data : data
                ,success : function (data){
                    $("#calendarDetailModal").html(data);
                    $("#calendarDetailModal").modal('show');
                }
            });
        }
    </script>
    <style>

        #calendarBody {
            /*margin: 40px 10px;*/
            margin-top: 40px;
            padding: 0;
            font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
            font-size: 14px;
        }

        #calendar {
            /*max-width: 1100px;*/
            max-width: 60rem;
            margin: 0 auto;
        }

    </style>
</head>
<body>
    <div layout:fragment="content" id="calendarBody">
        <div>
            <div class="modal fade" id="calendarCateModal" tabindex="-1" aria-labelledby="calendarCateModalLabel" aria-hidden="true"></div>

            <div class="modal fade" id="calendarDetailModal" tabindex="-1" aria-labelledby="calendarDetailModalLabel" aria-hidden="true"></div>

            <div class="modal fade" id="calendarDetailViewModal" tabindex="-1" aria-labelledby="calendarDetailModalViewLabel" aria-hidden="true"></div>
        </div>


        <!-- 캘린더 -->
        <div id='calendar'></div>
    </div>
</body>
</html>
